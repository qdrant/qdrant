version: '3.8'

services:
  qdrant-node1:
    image: ${QDRANT_IMAGE:-qdrant/qdrant:dev}
    ports:
      - "6333"
      - "6334"
    environment:
      - QDRANT__LOG_LEVEL=INFO
      - QDRANT__SERVICE__GRPC_PORT=6334
      - QDRANT__CLUSTER__ENABLED=true
      - QDRANT__CLUSTER__P2P__PORT=6335
    command: ["./qdrant", "--uri", "http://qdrant-node1:6335"]
    networks:
      - qdrant-network
    restart: unless-stopped

  qdrant-node2:
    image: ${QDRANT_IMAGE:-qdrant/qdrant:dev}
    ports:
      - "6333"
      - "6334"
    environment:
      - QDRANT__LOG_LEVEL=INFO
      - QDRANT__SERVICE__GRPC_PORT=6334
      - QDRANT__CLUSTER__ENABLED=true
      - QDRANT__CLUSTER__P2P__PORT=6335
    command: ["./qdrant", "--bootstrap", "http://qdrant-node1:6335", "--uri", "http://qdrant-node2:6335"]
    depends_on:
      - qdrant-node1
    networks:
      - qdrant-network
    restart: unless-stopped

  qdrant-node3:
    image: ${QDRANT_IMAGE:-qdrant/qdrant:dev}
    ports:
      - "6333"
      - "6334"
    environment:
      - QDRANT__LOG_LEVEL=INFO
      - QDRANT__SERVICE__GRPC_PORT=6334
      - QDRANT__CLUSTER__ENABLED=true
      - QDRANT__CLUSTER__P2P__PORT=6335
    command: ["./qdrant", "--bootstrap", "http://qdrant-node1:6335", "--uri", "http://qdrant-node3:6335"]
    depends_on:
      - qdrant-node1
    networks:
      - qdrant-network
    restart: unless-stopped

networks:
  qdrant-network:
    driver: bridge